<div i18n:domain="redturtle.portlet.collection"
     tal:define="mtool context/portal_membership;
                 plone_view nocall:context/@@plone;
                 normalizeString nocall:plone_view/normalizeString;
                 portal_url nocall:context/portal_url;
                 portal python:portal_url.getPortalObject();
                 portal_properties nocall:portal/portal_properties;
                 site_properties portal_properties/site_properties;
                 isAnon mtool/isAnonymousUser;
                 toLocalizedTime nocall:plone_view/toLocalizedTime;
                 collection view/collection;
                 query_results view/results;"
    tal:condition="python:collection">
	<dl class=""
        tal:attributes="id view/data/div_id;
		                class string:portlet rtCollectionPortlet ${class}"
        tal:define="collection_path python:'/'.join(collection.getPhysicalPath());
                    here nocall:collection;
                    context nocall:here;
                    collection_url view/collection_url;
	                getIcon nocall:plone_view/getIcon;
					class view/data/css_class|nothing;">
	    <dt class="portletHeader">
	    		<a class="rss_feed"
			    tal:condition="view/data/check_rss"
			    tal:attributes="href view/rss_url">
	             <img tal:attributes="src string:${context/portal_url}/rss.gif" alt="RSS icon"/>
				 RSS feed
	             </a>
			
	        <span class="portletTopLeft"></span>
	        <a tal:attributes="href collection_url" tal:omit-tag="not:view/data/show_more">
	            <span tal:content="view/data/header" />
	        </a>
	        <span class="portletTopRight"></span>
	    </dt>
	    
	    <tal:events tal:repeat="obj query_results">
	    <dd class="portletItem rtCollectionPortletItem"
	        tal:define="oddrow repeat/obj/odd;
	                    item_icon python:getIcon(obj);
						item_path obj/getPath;"
	        tal:attributes="class python:oddrow and 'portletItem even rtCollectionPortletItem' or 'portletItem odd rtCollectionPortletItem'">
			<p class="rt_item">
				<a href="#"
	           	   class="tile"
	           	   tal:attributes="href obj/getURL;
	                               title obj/Description">
	            	<img tal:replace="structure item_icon/html_tag" />
	            	<span tal:replace="obj/Title">
	             		Title
	            	</span>
	        	</a>
			</p>
	        <img src="" alt=""
	             tal:condition="exists:python:path('here'+item_path.replace('/'+portal.getId(), '')+'/image_thumb')"
	             tal:attributes="src string:${obj/getURL}/image_thumb;
				                 alt obj/Description;"
			     class="tileImage"/>
	
			<div>
				<span tal:content="obj/Description"/>
	            <span class="portletItemDetails"
	                  tal:condition="view/data/show_dates"
	                  tal:content="python:toLocalizedTime(obj.Date)">
	                Date
	            </span>
			</div>
			<div class="visualClear"><!-- --></div>
	
	    </dd>
	    </tal:events>

	    <dd class="portletItem rtCollectionPortletItem"
		    tal:define="no_elements_text view/data/no_elements_text"
			tal:condition="python:no_elements_text and len(query_results)==0">
	        <span class="portletBottomLeft"></span>
	        <span>
	        <div class="discreet" i18n:translate="" tal:content="no_elements_text" />
	        </span>
	        <span class="portletBottomRight"></span>
	    </dd>

	    <dd class="portletFooter"
		    tal:define="show_more view/data/show_more"
			tal:condition="show_more">
	        <span class="portletBottomLeft"></span>
	        <span>
	        <a tal:condition="not:view/data/link_text"
		       tal:attributes="href collection_url" i18n:translate="more_url">
	             More&hellip;
	             </a>
	        <a tal:condition="view/data/link_text"
			    tal:attributes="href collection_url"
				tal:content="view/data/link_text">
	             Custom text
	             </a>
	        </span>
	        <span class="portletBottomRight"></span>
	    </dd>

	</dl>
</div>
